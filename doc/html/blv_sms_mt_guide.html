<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SDK: SMS MT API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SDK&#160;<span id="projectnumber">1.6</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_sms_mt_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">SMS MT API guide </div>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="sms_mt_abstract_sec"></a>
Abstract</h2>
<p>The Bluevia SMS API is a set of functions which allows users to send SMS messages and to request the status of those previously sent SMS messages. This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia SMS functionality.</p>
<h2><a class="anchor" id="blv_sms_mt_api_sending_sms_messages_sec"></a>
Bluevia SMS MT API: Sending SMS messages</h2>
<p>The Bluevia SMS API is a set of functions which allows users to send SMS messages and to request the status of those previously sent SMS messages. This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia SMS functionality.</p>
<h3><a class="anchor" id="sms_mt_client_basics_sec"></a>
SMS MT client basics</h3>
<p>A SMS client represents the client side in a classic client-server schema. This object wraps up the underlying REST client side functionality needed to perform requests against a REST server.</p>
<p>Any Bluevia client performs requests and receives responses in a secure mode. Clients are authorized following the OAuth protocol. This security protocol enables users to grant third-party access to their resources without sharing their passwords. So clients store the authorization data -called security credentials- to grant access to the server. Following sections describe what security credentials we are talking about.</p>
<h3><a class="anchor" id="creating_a_sms_mt_client_sec"></a>
Creating a SMS MT client: BVMtSms class</h3>
<p>The first step in using the SMS client is to create a BVMtSms object. As we mentioned earlier this object could have three different working modes: i) as a client which sends requests to a real server, ii) a client working with a real server in testing mode, or iii) as a client which sends requests and receives responses to/from a sandbox server.</p>
<h4><a class="anchor" id="sms_mt_client_features_working_modes_sec"></a>
SMS MT client features: working modes</h4>
<p>When you create the client, you can specify various working modes: </p>
<ul>
<li>
<p class="startli">BVBaseClient.Mode.LIVE <br/>
In the Live environment your application uses the real network, which means that you will be able to send real transactions to real Movistar, O2 and Vivo customers in the applicable country.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">BVBaseClient.Mode.TEST <br/>
The Test mode behave exactly like the Live mode, but the API calls are free of chargue, using a credits system. You are required to have a Movistar, O2 or Vivo mobile number to get this monthly credits.</p>
<p class="endli"></p>
</li>
<li>
BVBaseClient.Mode.SANDBOX <br/>
The Sandbox environment offers you the exact same experience as the Live environment except that no traffic is generated on the live network, meaning you can experiment and play until your heartâ€™s content. </li>
</ul>
<h4><a class="anchor" id="sms_mt_client_features_security_credentials"></a>
SMS MT client features: security credentials</h4>
<p>Bluevia uses OAuth as its authentication mechanism which enables websites and applications to access the Bluevia API's without end users disclosing their personal credentials. In order to grant access to the server any client has to be created passing the security credential as parameter in its constructor. These security credentials are managed internally and added as a HTTP header in every request sent to the server. Such Oauth security credentials are: </p>
<ul>
<li>
<p class="startli"><b>Consumer key</b> <br/>
The string identifying the application- you obtained when you registered your application within the provisioning portal.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Consumer secret</b> <br/>
A secret -a string- used by the consumer to establish ownership of the consumer key.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Access token</b> <br/>
The token -a string- used by the client for granting access permissions to the server.</p>
<p class="endli"></p>
</li>
<li>
<b>Access token secret</b> <br/>
The secret of the access token. </li>
</ul>
<h4><a class="anchor" id="sms_mt_client_features_code_examples_sec"></a>
SMS MT client features: code examples</h4>
<p>Find below an example about how to create a Sms client object taking into account all information previously given. This snippet shows how to access a Bluevia server using OAuth security credentials</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Mode.LIVE indicating the client works against a real Bluevia server.</span>
<span class="keywordflow">try</span> {
        BVMtSms smsClient = <span class="keyword">new</span> BVMtSms(Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, <span class="stringliteral">&quot;access_token&quot;</span>, <span class="stringliteral">&quot;access_token_secret&quot;</span>);
} <span class="keywordflow">catch</span> (BlueviaException e){
        log.error(e.getMessage());
}
</pre></div><h4><a class="anchor" id="sms_mt_client_features_freeing_resources_sec"></a>
SMS MT client features: freeing resources</h4>
<p>It is very important to free the resources that the client instantiates to work. To do this call the close method after finishing using the client:</p>
<div class="fragment"><pre class="fragment">smsClient.close();
</pre></div><h3><a class="anchor" id="sending_smsmessages_sec"></a>
Sending SMS messages</h3>
<p>The BVMtSms object has several versions of the function for sending SMS messages. This function allows an user to send to one or more phone numbers, and to include an endpoint to receive delivery status notifications.</p>
<p>Take a look at this function:</p>
<div class="fragment"><pre class="fragment">String send(ArrayList&lt;String&gt; destination, String text, String endpoint, String correlator) <span class="keywordflow">throws</span> BlueviaException, IOException 
</pre></div><p>It sends a text message to a list of destinations. The endpoint and correlator optional parameters are included to receive status notifications. This function returns the SMS Id which indentifies that sending operation. This identification is useful to retrieve the delivery status of that SMS message using a polling method.</p>
<p>For a more detailed description see the API Reference.</p>
<h3><a class="anchor" id="sms_sending_notification"></a>
Sending SMS with status notification</h3>
<p>It is possible to receive status notifications by providing BlueVia with an URI where notifications must be sent. This URI is provided during the SMS sending, including the optional parameters endpoint and correlator: </p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        <span class="comment">// 1. Configure data</span>
        String phoneNumber = <span class="stringliteral">&quot;123456789&quot;</span>;
        String endpoint= <span class="stringliteral">&quot;https://www.myendpoint.com&quot;</span>;
        String criteria= <span class="stringliteral">&quot;criteria&quot;</span>;

        <span class="comment">// 2. Create the client</span>
        BVMoSms smsClient = <span class="keyword">new</span> BVMoSms(mode, token, secret);
        
        <span class="comment">// 3. Subscribe to notifications with configured data</span>
        String correlator= smsClient.startNotification(phoneNumber, endpoint, criteria);
        System.out.println(<span class="stringliteral">&quot;Correlator: [&quot;</span>+ correlator +<span class="stringliteral">&quot;]&quot;</span>);

        <span class="comment">/* ... */</span>
        <span class="comment">// 4. Unsubscribe from notification</span>
        smsClient.stopNotification(correlator);
                                          
} <span class="keywordflow">catch</span> (BlueviaException e) {
        log.error(e.getMessage());
}
</pre></div><p> Note that although your are requesting delivery status notifications, you still are able to use the Location header to ask for delivery status following the polling strategy. Your application must reply with a 204 No Content HTTP status and no body.</p>
<p>For a more detailed description see the API Reference.</p>
<h3><a class="anchor" id="requesting_the_status_of_a_previously_sent_SMS_messages"></a>
Requesting the status of a previously sent SMS messages</h3>
<p>Once the SMS message is sent successfully the user may want to know the delivery status of that SMS message. The Sms client allows an user to determine if the SMS message reaches the destination or not. For this matter we use the getDeliveryStatus function. Just pass the SMS Id -returned by the send function- and retrieve the delivery status of that message, so easy!.</p>
<p>Take a look at this function: </p>
<div class="fragment"><pre class="fragment">ArrayList&lt;DeliveryInfo&gt; getDeliveryStatus(String messageId) <span class="keywordflow">throws</span> BlueviaException, IOException 
</pre></div><p> It obtains the delivery status of a previously sent SMS message.</p>
<p>Possible delivery statuses are: </p>
<ul>
<li>
DeliveredToNetwork. </li>
<li>
DeliveryUncertain. </li>
<li>
DeliveryImpossible. </li>
<li>
MessageWaiting. </li>
<li>
DeliveredToTerminal. </li>
<li>
DeliveryNotificationNotSupported. </li>
</ul>
<p>For a more detailed description see the API Reference.</p>
<h3><a class="anchor" id="blv_sms_api_code_example"></a>
Bluevia SMS MT API: code example</h3>
<div class="fragment"><pre class="fragment"><span class="comment">// Sending a SMS</span>

BVMtSms smsClient = null;

<span class="keywordflow">try</span> {

        <span class="comment">// 1. Create the client (you have to choose the mode and include the OAuth authorization values)</span>
        smsClient = <span class="keyword">new</span> BVMtSms(Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, <span class="stringliteral">&quot;access_token&quot;</span>, <span class="stringliteral">&quot;access_token_secret&quot;</span>);

        <span class="comment">// 2. Send the message.</span>
        String smsId = smsClient.send(<span class="stringliteral">&quot;600010101&quot;</span>, <span class="stringliteral">&quot;This is the text to be sent using Bluevia API&quot;</span>);

        <span class="comment">// 3. Retrieve the delivery status of the sent SMS.</span>
        ArrayList&lt;DeliveryInfo&gt; statusList = smsClient.getDeliveryStatus(smsId);
    <span class="keywordflow">for</span> (DeliveryInfo status : statusList) {
        System.out.println(<span class="stringliteral">&quot;Delivery status: &quot;</span> + status.getStatus());
    }

} <span class="keywordflow">catch</span> (BlueviaException e) {
        log.error(<span class="stringliteral">&quot;BlueviaException: &quot;</span> + e.getMessage());
} <span class="keywordflow">catch</span> (IOException ex) {
        log.error(<span class="stringliteral">&quot;IOException: &quot;</span> + ex);
} <span class="keywordflow">finally</span> {
        <span class="comment">// 4. Close the client</span>
        <span class="keywordflow">if</span> (client != null)     client.close();                 
}
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Wed May 30 2012 15:09:20 for SDK by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
