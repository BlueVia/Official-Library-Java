<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Bluevia: Payment for Trusted Partners API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bluevia&#160;<span id="projectnumber">1.1.2</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_payment_trusted_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>Payment for Trusted Partners API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="payment_trusted_abstract_sec"></a>
Abstract</h2>
<p>The Bluevia Payment API is a set of functions that enables individual, atomic payments based on input economic information; for Bluevia Trusted Parterns, using SSL-2-way authentication. This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia Payment functionality.</p>
<h2><a class="anchor" id="payment_ssl2way_sec"></a>
SSL-2-way</h2>
<p>Bluevia Payment for Trusted Parters API uses SSL 2-way authentication to guarantee secure payment operations. This refers to a client or user authenticating themselves to a server and that server authenticating itself to the user in such a way that both parties are assured of the others' identity. Trusted Partners will own a client certificate trusted by Bluvia gSDP to allow these operations.</p>
<h3><a class="anchor" id="payment_ssl2way_config_sec"></a>
Configuring the SDK</h3>
<p>Bluevia SDK needs the client certificate to be supplied propertly and JSSE provides the API and the necessary tools to do that. Keytool is a key and certification management tool to allow users to administer its certificates and keystores. More information can be obtained in <a href="http://download.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html">JSSE Reference Guide</a> and in <a href="http://download.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html">keytool - Key and Certificate Management Tool</a>.</p>
<p>We assume that the client's certificate has been issued in PKCS#12 format, which is the format that is accepted by browsers for importation in their keystore. In order to configure the JVM to use the certificate, the following properties must be set:</p>
<ul>
<li>
<b>javax.net.ssl.keyStore</b> <br/>
the path to the keystore where client's key is stored </li>
<li>
<b>javax.net.ssl.keyStoreType</b> <br/>
the type of storage for this store, maybe either jks (default) or pkcs12. In this case, pkcs12 is needed. </li>
<li>
<b>javax.net.ssl.keyStorePassword</b> <br/>
the password protecting the store </li>
</ul>
<p>There are several ways to set the properties, depending the envinronment where the application is running. It is the responsibility of the developer to investigate the most appropriate for each case. For instance, Maven configuration is made using a .mavenrc file (which should be located in home directory). This is an example of the .mavenrc <a href="file:">file:</a></p>
<div class="fragment"><pre class="fragment">MAVEN_OPTS=<span class="stringliteral">&quot;-Xmx512m -Djavax.net.ssl.keyStore=/path/to/keystore.p12 \</span>
<span class="stringliteral">                     -Djavax.net.ssl.keyStoreType=pkcs12 \</span>
<span class="stringliteral">                     -Djavax.net.ssl.keyStorePassword=XXXXXX \</span>
<span class="stringliteral">                     -Djavax.net.debug=ssl&quot;</span> \
</pre></div><h2><a class="anchor" id="make_payment_trusted_sec"></a>
Make a Payment</h2>
<p>Once the user has requested the access token it is possible to make the payment. The Payment info included in this request must agree with the info supplied when the token was requested.</p>
<div class="fragment"><pre class="fragment">TrustedPayment op = <span class="keyword">new</span> TrustedPayment(consumer, mode);

PaymentParamsType params = <span class="keyword">new</span> PaymentParamsType();

PaymentInfoType pInfo = <span class="keyword">new</span> PaymentInfoType();
UserIdType user = <span class="keyword">new</span> UserIdType();
user.setPhoneNumber(<span class="stringliteral">&quot;34666223344&quot;</span>);
pInfo.setEndUserIdentifier(user);
pInfo.setCode(<span class="stringliteral">&quot;code&quot;</span>);
pInfo.setReferencecode(<span class="stringliteral">&quot;referenceCode&quot;</span>);
pInfo.setDescription(<span class="stringliteral">&quot;description&quot;</span>);
params.setPaymentInfo(pInfo);

PaymentResultType result = op.payment(params);

System.out.println(<span class="stringliteral">&quot;Transaction id: &quot;</span> + result.getTransactionId());
System.out.println(<span class="stringliteral">&quot;Transaction status: &quot;</span> + result.getTransactionStatus());
</pre></div><h2><a class="anchor" id="refund_sec"></a>
Refund a payment</h2>
<p>Payment can be refunded using the received transaction id:</p>
<div class="fragment"><pre class="fragment">RefundParamsType refundParams = <span class="keyword">new</span> RefundParamsType();

UserIdType user = <span class="keyword">new</span> UserIdType();
user.setPhoneNumber(<span class="stringliteral">&quot;34666223344&quot;</span>);
refundParams.setEndUserIdentifier(user);

refundParams.setTransactionId(result.getTransactionId());
op.refund(refundParams);
</pre></div><h2><a class="anchor" id="payment_code_example_sec"></a>
Bluevia Payment API: Code example</h2>
<div class="fragment"><pre class="fragment">System.out.println(<span class="stringliteral">&quot;***** PaymentExample&quot;</span>);

<span class="keywordflow">try</span> {
        TrustedPayment op = <span class="keyword">new</span> TrustedPayment(consumer, mode);

        PaymentParamsType params = <span class="keyword">new</span> PaymentParamsType();

        PaymentInfoType pInfo = <span class="keyword">new</span> PaymentInfoType();
        UserIdType user = <span class="keyword">new</span> UserIdType();
        user.setPhoneNumber(<span class="stringliteral">&quot;34666223344&quot;</span>);
        pInfo.setEndUserIdentifier(user);
        pInfo.setCode(<span class="stringliteral">&quot;code&quot;</span>);
        pInfo.setReferencecode(<span class="stringliteral">&quot;referenceCode&quot;</span>);
        pInfo.setDescription(<span class="stringliteral">&quot;description&quot;</span>);
        params.setPaymentInfo(pInfo);

        PaymentResultType result = op.payment(params);

        System.out.println(<span class="stringliteral">&quot;Transaction id: &quot;</span> + result.getTransactionId());
        System.out.println(<span class="stringliteral">&quot;Transaction status: &quot;</span> + result.getTransactionStatus());

        RefundParamsType refundParams = <span class="keyword">new</span> RefundParamsType();
        refundParams.setEndUserIdentifier(user);
        refundParams.setTransactionId(result.getTransactionId());
        op.refund(refundParams);

} <span class="keywordflow">catch</span> (JAXBException ex) {
        Logger.getLogger(PaymentExample.class.getName()).log(Level.SEVERE, null, ex);
} 
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Mon Nov 21 2011 16:22:43 for Bluevia by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
