<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Bluevia: MMS API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bluevia&#160;<span id="projectnumber">1.5</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_mms_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>MMS API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="mms_abstract_sec"></a>
Abstract</h2>
<p>The Bluevia MMS API is a set of functions which allows users to send and receive MMS messages and to request the status of those previously sent MMS messages. This guide provides some code samples to develop applications using the Bluevia MMS functionality.</p>
<h3><a class="anchor" id="content_types_sec"></a>
Available content types</h3>
<p>The following list contains the available content-types in Bluevia:</p>
<ul>
<li>
text/plain </li>
<li>
image/jpeg </li>
<li>
image/bmp </li>
<li>
image/gif </li>
<li>
image/png </li>
<li>
audio/amr </li>
<li>
audio/midi </li>
<li>
audio/mp3 </li>
<li>
audio/mpeg </li>
<li>
audio/wav </li>
<li>
video/mp4 </li>
<li>
video/avi </li>
<li>
video/3gpp </li>
</ul>
<h3><a class="anchor" id="send_mms_sec"></a>
Sending MMS Example</h3>
<div class="fragment"><pre class="fragment">OAuthToken consumer = <span class="keyword">new</span> OAuthToken(<span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>);
OAuthToken accesstoken = <span class="keyword">new</span> OAuthToken(<span class="stringliteral">&quot;token&quot;</span>, <span class="stringliteral">&quot;token_secret&quot;</span>);

<span class="comment">// Create message sender</span>
MessageMT messageSender = <span class="keyword">new</span> MessageMT(consumer, accesstoken, Mode.LIVE);

<span class="comment">// Prepare MMS parameters</span>
String addresses[] = { <span class="stringliteral">&quot;5421100001&quot;</span> };
Attachment[] files = {<span class="keyword">new</span> Attachment(<span class="stringliteral">&quot;image.jpg&quot;</span>, ContentType.IMAGE_JPEG), <span class="keyword">new</span> Attachment(<span class="stringliteral">&quot;message.txt&quot;</span>, ContentType.TEXT_PLAIN)};      <span class="comment">//Fake attachments</span>
String subject = <span class="stringliteral">&quot;Hello Bluevia!&quot;</span>;

<span class="comment">// Sending MMS</span>
String mmsId = messageSender.send(addresses, files, subject);

<span class="keywordflow">if</span> (mmsId != null) {
    System.out.println(<span class="stringliteral">&quot;Mms was sent. Id: &quot;</span> + mmsId);
}

<span class="comment">// Getting delivery status</span>
MessageDeliveryStatusType response = messageSender.getStatus(mmsId);
List&lt;DeliveryInformationType&gt; list = response.getMessageDeliveryStatus();

<span class="keywordflow">for</span> (DeliveryInformationType status : list) {
    System.out.println(<span class="stringliteral">&quot;Delivery status: &quot;</span> + status.getDeliveryStatus());
}
</pre></div><h3><a class="anchor" id="send_mms_notif_sec"></a>
Sending MMS with status notification</h3>
<p>It is possible to receive status notifications by providing BlueVia with an URI where notifications must be sent. This URI is provided during the MMS sending, including the optional paramters endpoint and correlator:</p>
<div class="fragment"><pre class="fragment">String dest[] = { <span class="stringliteral">&quot;527902135544&quot;</span> };
String[] filePaths = <span class="keyword">new</span> String[1];
filePaths[0] = <span class="stringliteral">&quot;mytext.txt&quot;</span>;
MessageMT mt = <span class="keyword">new</span> MessageMT(consumer, accesstoken, Mode.LIVE);
<span class="comment">// sendMessage with notification</span>
String res = mt.send(dest, attachments, <span class="stringliteral">&quot;subject&quot;</span>, <span class="stringliteral">&quot;https://www.myendpoint.com&quot;</span>, <span class="stringliteral">&quot;b7ke93x_3&quot;</span>);
</pre></div><p>Note that although your are requesting delivery status notifications, you still are able to use the Location header to ask for delivery status following the polling strategy. Your application must reply with a 204 No Content HTTP status and no body.</p>
<h3><a class="anchor" id="receive_mms_sec"></a>
Receiving MMS Example</h3>
<p>This API uses Oauth 2-legged, so access token is not mandatory and applications does not need user's permissions.</p>
<p>The operation to get received messages has to be done in two steps. First you have to use the getMessages function to retreive the messages info, including a message identifier. Depending on the value of the useAttachmentIds parameter, the second step would be done in two different ways. If the parameter is true, the ids of the attachments will be retreived in order to use the getAttachment operation; otherwise the attachments would have to be obtained throught the getMessage function.</p>
<div class="fragment"><pre class="fragment">OAuthToken consumer = <span class="keyword">new</span> OAuthToken(<span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>);

<span class="comment">// Create mms receiver</span>
MessageMO mmsReceiver = <span class="keyword">new</span> MessageMO(consumer, Mode.LIVE);
<span class="keywordtype">boolean</span> useAttachmentIds = <span class="keyword">true</span>; <span class="comment">//</span>

<span class="comment">// Prepare params</span>
String registrationId = <span class="stringliteral">&quot;546780&quot;</span>;

<span class="comment">// Get messages info</span>
ReceivedMessagesType response = mmsReceiver.getMessages(registrationId, useAttachmentIds);
List&lt;MessageReferenceType&gt; list = response.getReceivedMessages();

<span class="keywordflow">for</span> (MessageReferenceType messageReference : list){

        <span class="comment">// Do stuff</span>
}
</pre></div><p>Using getAttachment:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">for</span> (MessageReferenceType messageReference : list){

        System.out.println(<span class="stringliteral">&quot;Message from: &quot;</span> + messageReference.getOriginAddress().getPhoneNumber());
        System.out.println(<span class="stringliteral">&quot; &gt; Subject: &quot;</span> + messageReference.getSubject());

        List&lt;MessageURIType&gt; atts = messageReference.getAttachmentURL();
        <span class="keywordflow">for</span> (MessageURIType uri : atts){
                System.out.println(<span class="stringliteral">&quot;Attachment:&quot;</span>);
                System.out.println(<span class="stringliteral">&quot;Id: &quot;</span> + uri.getHref());
                System.out.println(<span class="stringliteral">&quot;Content-type: &quot;</span> + uri.getContentType());

                <span class="comment">//Get attachments</span>
                MimeContent attachment = mmsReceiver.getAttachment(registrationId, 
                        messageReference.getMessageIdentifier(), uri.getHref());

                <span class="comment">//Do stuff...</span>
                System.out.println(attachment.getFileName());
        }
}
</pre></div><p>Using getMessage:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">for</span> (MessageReferenceType messageReference : list){
        
        ReceivedMMS mms = mmsReceiver.getMessage(registrationId, messageReference.getMessageIdentifier());
        System.out.println(<span class="stringliteral">&quot;Message from: &quot;</span> + mms.getMessage().getOriginAddress().getPhoneNumber());
        System.out.println(<span class="stringliteral">&quot; &gt; Subject: &quot;</span> + mms.getMessage().getSubject());


        <span class="comment">// Get attachments...</span>
        ArrayList&lt;MimeContent&gt; contents = mms.getAttachments();
        <span class="keywordflow">for</span> (MimeContent content : contents){
                <span class="comment">//Do stuff...</span>
                System.out.println(content.getFileName());
        }
}
</pre></div><h3><a class="anchor" id="notifications_sec"></a>
Received SMSs Notifications Example</h3>
<p>To receive notifications about MMS sent to your applications you must provide an endpoint whit the URI where notifications must be sent and a correlator element with and identifier to correlate notifications with subscriptions This API uses Oauth 2-legged, so access token is not mandatory and applications does not need user's permissions.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Create Notification type to subscribe or unsusbcribe</span>
NotificationManager nm = <span class="keyword">new</span> NotificatdionManager(consumer, Mode.LIVE);
MessageNotificationType mnt = <span class="keyword">new</span> MessageNotificationType();

<span class="comment">// Create a SimpleReferenceType with an endpoint and a correlator identifier</span>
SimpleReferenceType valueRef = <span class="keyword">new</span> SimpleReferenceType();
valueRef.setCorrelator(<span class="stringliteral">&quot;b7ke93x_3&quot;</span>);
valueRef.setEndpoint(<span class="stringliteral">&quot;https://www.myendpoint.com&quot;</span>);
snt.setReference(valueRef);

<span class="comment">// Setup the destination number</span>
UserIdType userIdType1 = <span class="keyword">new</span> UserIdType();
userIdType1.setPhoneNumber(<span class="stringliteral">&quot;546780&quot;</span>);
snt.getDestinationAddress().add(userIdType1);

<span class="comment">// Define the criteria element containing the keyword you chose for your application when you requested the API key (keywords are case-insensitive)</span>
String criteriaValue = <span class="stringliteral">&quot;MYKEYWORD&quot;</span>;
snt.setCriteria(criteriaValue);

<span class="comment">// Start notifications</span>
String notifId = nm.subscribe(snt);
</pre></div><p>If you want to unsubscribe and stop reveiving notifications you should call the unsusbscribe function where the nofitication id is the string returned by the subscribe function.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Stop notifications</span>
nm.unsubscribeNotification(notifId);
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Thu Jan 26 2012 12:33:27 for Bluevia by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
