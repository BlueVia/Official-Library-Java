<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Bluevia: Oauth reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bluevia&#160;<span id="projectnumber">1.5</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_oauth_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>Oauth reference </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="oauth_abstract_sec"></a>
Abstract</h2>
<p>The Bluevia OAuth API is a set of functions which allows applications to retrieve request and access tokens to complete the OAuth authentication protocol, necessary to be able to get and send data to BlueVia APIs. This guide represents a practical introduction to include the OAuth protocol in Bluevia applications.</p>
<h2><a class="anchor" id="oauth_protocol_sec"></a>
Bluevia OAuth protocol</h2>
<p>The Bluevia OAuth API is a set of functions which allows applications to retrieve request and access tokens to complete the OAuth authentication protocol, necessary to be able to get and send data to BlueVia APIs. This guide represents a practical introduction to include the OAuth protocol in Bluevia applications.</p>
<p>OAuth definitions:</p>
<ul>
<li>
<b>User:</b> Customer of Telefonica who has an account with BlueVia and can, therefore, use the underlying services via a BlueVia API. </li>
<li>
<b>Consumer:</b> An application that uses OAuth to access the BlueVia APIs on behalf of the User. </li>
<li>
<b>Consumer Key:</b> A value used by the Consumer to identify itself with BlueVia. </li>
<li>
<b>Consumer Secret:</b> Secret used by the Consumer to guarantee the ownership of the consumer key. </li>
<li>
<b>Request Token:</b> A value used by the Consumer to obtain authorization from the User. The Request Token is exchanged for an Access Token when permission is granted. </li>
<li>
<b>Access Token:</b> A value used by the Consumer to call Bluevia APIs on behalf of the User (instead of using the Userâ€™s credentials) </li>
</ul>
<p>The Consumer credentials are unique for each application registered in the Bluevia portal, and can be obtained by requesting an API key. Visit the API authentication reference for more information about <a href="https://bluevia.com/en/knowledge/getStarted.Authentication#GetConsumerCredentials" target="blank">getting Consumer credentials</a>.</p>
<h3><a class="anchor" id="oauth_process_sec"></a>
OAuth process</h3>
<p>OAuth process must to follow this process:</p>
<ul>
<li>
Retrieve a request token. </li>
<li>
The user authorises the application. </li>
<li>
Exchange the request token for an access token. </li>
</ul>
<p>The Consumer credentials and the resulting Access Token will be supplied to the different clients to allow them to connect to the BlueVia APIs.</p>
<h4><a class="anchor" id="retrieving_request_token_sec"></a>
Retrieving a request token</h4>
<p>First, you have to retrieve a request token to be authorised by the user. The process will be different depending on the callback URL parameter:</p>
<ul>
<li>
Web Oauth: callback parameter should be an URL if your app can receive callbacks and you want to get informed about the result of the authorization process. </li>
<li>
SMS Oauth: a phone number if you want the user to receive the oauth verifier by SMS. </li>
<li>
OutOfBand Oauth: null, if your application is not able to receive request from BlueVia. Typically websites set a callBackURL and desktop or mobile applications don't. </li>
</ul>
<p>To get user authorization using the oauth_token from your request token (only for OutOfBand and WebOauth authorization modes), you have to take the user to BlueVia including your oauth_token as a request parameter. Depending on the mode used, the token obtained will be available for final users (LIVE) or developers (TEST and SANDBOX). The URL will be composed by the library and you can get is as follow:</p>
<div class="fragment"><pre class="fragment">String url = requestToken.getUrl();
</pre></div><p>For a more detailed description please see the API Reference.</p>
<p>Web Oauth example:</p>
<div class="fragment"><pre class="fragment">OAuthToken consumer = <span class="keyword">new</span> OAuthToken(CONSUMER_KEY, CONSUMER_SECRET);
RequestToken rt = <span class="keyword">new</span> RequestToken(consumer, Mode.LIVE);

String callbackUrl = <span class="stringliteral">&quot;https://www.example.com&quot;</span>;
OAuthToken requestToken = rt.getRequestToken(callbackUrl);
</pre></div><p>SMS Oauth example:</p>
<div class="fragment"><pre class="fragment">OAuthToken consumer = <span class="keyword">new</span> OAuthToken(CONSUMER_KEY, CONSUMER_SECRET);
RequestToken rt = <span class="keyword">new</span> RequestToken(consumer, Mode.LIVE);
String phoneNumber = <span class="stringliteral">&quot;34609090909&quot;</span>;
OAuthToken requestToken = rt.getRequestToken(phoneNumber);
</pre></div><p>OutOfBand Oauth example:</p>
<div class="fragment"><pre class="fragment">OAuthToken consumer = <span class="keyword">new</span> OAuthToken(CONSUMER_KEY, CONSUMER_SECRET);
RequestToken rt = <span class="keyword">new</span> RequestToken(consumer, Mode.LIVE);
OAuthToken requestToken = rt.getRequestToken();
</pre></div><p>Once the user confirms the authorization, depending on your choice you have to:</p>
<ul>
<li>
Web Oauth: you will receive the PIN code (oauth_verifier) as a request parameter at your callback_url. </li>
<li>
SMS and OutOfBand Oauth: you have to ask the user to enter the oauth_verifier in your app. </li>
</ul>
<p>Note that your users will need to copy and paste the oauth_verifier manually, so be clear when you request it to be sure they do not get confused.</p>
<h4><a class="anchor" id="retrieving_access_token_sec"></a>
Retrieveing an access token</h4>
<p>With the obatined oauth_verifier, you can now get the accessToken from the user as follows:</p>
<div class="fragment"><pre class="fragment">AccessToken at = <span class="keyword">new</span> AccessToken(consumer, requestToken);
OAuthToken accessToken = at.get(PIN_CODE);
</pre></div><h3><a class="anchor" id="oauth_code_example_sec"></a>
Bluevia Oauth API: Code example</h3>
<div class="fragment"><pre class="fragment"><span class="comment">// URL Host</span>
OAuthToken consumer = <span class="keyword">new</span> OAuthToken(CONSUMER_KEY, CONSUMER_SECRET);
RequestToken rt = <span class="keyword">new</span> RequestToken(consumer);
String callbackUrl = <span class="stringliteral">&quot;https://www.example.com&quot;</span>;
OAuthToken requestToken = rt.getRequestToken(callbackUrl);

System.out.println(<span class="stringliteral">&quot;Request Token:&quot;</span> + requestToken.getToken());
System.out.println(<span class="stringliteral">&quot;Request Token Secret:&quot;</span> + requestToken.getSecret());
System.out.println(<span class="stringliteral">&quot;Portal url:&quot;</span> + requestToken.getUrl());


<span class="comment">/*</span>
<span class="comment">  1. redirect to portal</span>
<span class="comment">  2. get response and get oauth_verifier from url response</span>
<span class="comment">  3. user oauth_verifier &amp; requestToken to call getAccessToken</span>
<span class="comment"> */</span>
   
String oauth_verifier = PIN_CODE; <span class="comment">// Obtain this value from Bluevia in any of the possible ways</span>

AccessToken at = <span class="keyword">new</span> AccessToken(consumer, requestToken);

OAuthToken accessToken = at.get(oauth_verifier);
System.out.println(<span class="stringliteral">&quot;Access Token:&quot;</span> + accessToken.getToken());
System.out.println(<span class="stringliteral">&quot;Access Token Secret:&quot;</span> + accessToken.getSecret());
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Thu Jan 26 2012 12:33:27 for Bluevia by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
