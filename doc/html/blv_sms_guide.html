<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Bluevia: SMS API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bluevia&#160;<span id="projectnumber">1.1.2</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_sms_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>SMS API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="sms_abstract_sec"></a>
Abstract</h2>
<p>The Bluevia SMS API is a set of functions which allows users to send and receive SMS messages (both text and binary SMS messages) and to request the status of those previously sent SMS messages. This guide provides some code samples to develop applications using the Bluevia SMS functionality.</p>
<h3><a class="anchor" id="send_sms_sec"></a>
Sending SMS Example</h3>
<div class="fragment"><pre class="fragment">OAuthToken consumer = <span class="keyword">new</span> OAuthToken(<span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>);
OAuthToken accesstoken = <span class="keyword">new</span> OAuthToken(<span class="stringliteral">&quot;token&quot;</span>, <span class="stringliteral">&quot;token_secret&quot;</span>);

<span class="comment">// Create message sender</span>
MessageMT messageSender = <span class="keyword">new</span> MessageMT(consumer, accesstoken, Mode.LIVE);

<span class="comment">// Prepare SMS parameters</span>
String addresses[] = { <span class="stringliteral">&quot;5421100001&quot;</span> };
String message = <span class="stringliteral">&quot;Hello Bluevia!&quot;</span>;

<span class="comment">// Sending SMS</span>
String smsId = messageSender.send(addresses, message);
<span class="keywordflow">if</span> (smsId != null) {
    System.out.println(<span class="stringliteral">&quot;Sms was sent. Id: &quot;</span> + smsId);
}

<span class="comment">// Getting delivery status</span>
SMSDeliveryStatusType response = messageSender.getStatus(smsId);
List&lt;DeliveryInformationType&gt; list = response.getSmsDeliveryStatus();

<span class="keywordflow">for</span> (DeliveryInformationType status : list) {
    System.out.println(<span class="stringliteral">&quot;Delivery status: &quot;</span> + status.getDeliveryStatus());
}
</pre></div><h3><a class="anchor" id="send_sms_notif_sec"></a>
Sending SMS with status notification</h3>
<p>It is possible to receive status notifications by providing BlueVia with an URI where notifications must be sent. This URI is provided during the SMS sending, including the optional paramters endpoint and correlator:</p>
<div class="fragment"><pre class="fragment">String dest[] = { <span class="stringliteral">&quot;5721100001&quot;</span> };
MessageMT mt = <span class="keyword">new</span> MessageMT(consumer, accesstoken, Mode.LIVE);
String <span class="keywordtype">id</span> = mt.send(dest, MESSAGE_TEXT, <span class="stringliteral">&quot;https://www.myendpoint.com&quot;</span>,<span class="stringliteral">&quot;b7ke93x_3&quot;</span>);
</pre></div><p>Note that although your are requesting delivery status notifications, you still are able to use the Location header to ask for delivery status following the polling strategy. Your application must reply with a 204 No Content HTTP status and no body.</p>
<h3><a class="anchor" id="receive_sms_sec"></a>
Receiving SMS Example</h3>
<div class="fragment"><pre class="fragment">OAuthToken consumer = <span class="keyword">new</span> OAuthToken(<span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>);
OAuthToken accesstoken = <span class="keyword">new</span> OAuthToken(<span class="stringliteral">&quot;token&quot;</span>, <span class="stringliteral">&quot;token_secret&quot;</span>);

<span class="comment">// Create the sms receiver</span>
MessageMO smsReceiver = <span class="keyword">new</span> MessageMO(consumer, accesstoken, Mode.LIVE);

<span class="comment">// Prepare params</span>
String registrationId = <span class="stringliteral">&quot;546780&quot;</span>;

<span class="comment">// Get Messages</span>
ReceivedSMSType response = smsReceiver.getMessages(registrationId);
List&lt;SMSMessageType&gt; list = response.getReceivedSMS();

<span class="keywordflow">for</span> (SMSMessageType sms : list){
        System.out.println(<span class="stringliteral">&quot;Received SMS from &#39;&quot;</span> + 
                sms.getOriginAddress().getPhoneNumber() + 
                <span class="stringliteral">&quot;&#39; &gt; &#39;&quot;</span> + sms.getMessage() + <span class="stringliteral">&quot;&#39;&quot;</span>);
}
</pre></div><h3><a class="anchor" id="notifications_sec"></a>
Received SMSs Notifications Example</h3>
<p>Your application can receive SMSs by providing BlueVia with an URI where notifications must be sent:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Create Notification type to subscribe or unsusbcribe</span>
NotificationManager nm = <span class="keyword">new</span> NotificationManager(consumer, accesstoken, Mode.LIVE);
SMSNotificationType snt = <span class="keyword">new</span> SMSNotificationType();

<span class="comment">// Create a SimpleReferenceType with an endpoint and a correlator identifier</span>
SimpleReferenceType valueRef = <span class="keyword">new</span> SimpleReferenceType();
valueRef.setCorrelator(<span class="stringliteral">&quot;b7ke93x_3&quot;</span>);
valueRef.setEndpoint(<span class="stringliteral">&quot;https://www.myendpoint.com&quot;</span>);
snt.setReference(valueRef);

<span class="comment">// Setup the destination number</span>
UserIdType userIdType1 = <span class="keyword">new</span> UserIdType();
userIdType1.setPhoneNumber(<span class="stringliteral">&quot;546780&quot;</span>);
snt.getDestinationAddress().add(userIdType1);

<span class="comment">// Define the criteria element containing the keyword you chose for your application when you requested the API key (keywords are case-insensitive)</span>
String criteriaValue = <span class="stringliteral">&quot;MYKEYWORD&quot;</span>;
snt.setCriteria(criteriaValue);

<span class="comment">// Start notifications</span>
String res = nm.subscribe(snt);
</pre></div><p>If you want to unsubscribe and stop reveiving notifications you should call the unsusbscribe function where the notificiation id is the string returned by the subscribe function.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Stop notifications</span>
nm.unsubscribeNotification(notifId);
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Tue Nov 22 2011 16:02:50 for Bluevia by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
